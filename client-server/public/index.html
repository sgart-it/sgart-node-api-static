<html>
  <head>
    <title>Demo Client CORS - Sgart.it</title>
  </head>

  <body>
    <h1>Demo chiamate AJAX su un dominio differente</h1>

    <h3>Risultato chiamata</h3>
    <hr />
    <div id="result"></div>
    <hr />
    <button id="btn-reload" type="button">Reload</button>
    <div style="color:red">
      <p>Attenzione impostare nel file C:\Windows\System32\drivers\etc\hosts 
        <p>127.0.0.1 static.sgart.it</p>
        <p>poi richiamare la pagina con <a href="http://static.sgart.it:8080">http://static.sgart.it:8080</a>.</p>
      </p>
    </div>
    <script>
      function load() {
        const elem = document.getElementById("result");

        //fetch("http://cors.localhost:3000/", {  // non funziona per le restrizioni del browser
        fetch("http://api.sgart.it:3000/demo", {
          method: "POST",
          mode: "cors", // parametro vincolante per le chiamate cross domain
          headers: {
            "Content-Type": "application/json",
            //Authorization: "Bearer mH4eyJdb...r2E2JRHDcdfxjoYtg",
          },
          body: JSON.stringify({ value: 1 }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            elem.innerHTML = JSON.stringify(data);
          })
          .catch((error) => {
            console.error(error);
            elem.innerHTML = error;
          });
      }

      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("btn-reload")
          .addEventListener("click", function () {
            load();
          });
        load();
      });
    </script>
  </body>
</html>
